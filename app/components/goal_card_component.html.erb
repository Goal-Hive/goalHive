
<%= link_to @goal do %>
  <div class="p-3 dark:bg-dark-goalCard border shadow-md border-gray-100 bg-white border-opacity-10 rounded-lg hover:border-indigo-200 flex flex-col" data-controller="toggle">

    <!--  Play/Pause - Options -->
    <div class="flex justify-between h-10">
      <%= button_to (image_tag "#{@status_icon}.svg"),
                    update_status_goal_path(id: @goal.id),
                    method: :post,
                    data: {
                      goal_id: @goal.id,
                      action: 'click->goals#toggleStatus' } %>
      <div class="flex items-center gap-x-2">
        <!--  Delete, Category, Details-->

        <div class="hidden flex justify-end items-center gap-x-3" data-toggle-target="toggledContent">

          <%= button_to (image_tag 'delete.svg'),
                        goal_path(@goal), method: :delete,
                        class: "w-9 h-9 flex justify-center items-center rounded-2xl p-2 bg-red-100" %>
          <%#= link_to (image_tag 'edit.svg'),
                    edit_goal_path(@goal),
                    class: "w-9 h-9 flex justify-center items-center rounded-2xl p-2 bg-gray-100 inline-block font-medium" %>
          <%#= link_to (image_tag 'category.svg'),
                    @goal,
                    class: "w-9 h-9 flex justify-center items-center rounded-2xl p-1 bg-gray-100 inline-block font-medium" %>
          <button data-action="click->toggle#toggleContent"
                  class="flex justify-center items-center rounded-2xl bg-light-bg-secondary w-9 h-9 text-2xl text-light-text-lightGray p-2">
            <%= image_tag 'x.svg', class: "w-3 h-3" %>
          </button>
        </div>
        <button data-action="click->toggle#toggleContent" data-toggle-target="toggleBtn">
          <%= image_tag 'dots.svg' %>
        </button>
        <!--end-->
      </div>
    </div>
    <!--end-->

    <!--  Goal Card Details-->
    <div class="flex flex-col gap-y-2" data-controller="milestones" data-milestones-goal_id=<%= @goal.id %>>

      <div class="w-fit mt-3 text-xs font-medium text-light-text-secondary dark:text-white">
        <%= @goal.category.name %>
      </div>
      <h3 class="w-full font-semibold text-xl dark:text-white text-light-text-title">
        <%= link_to @goal.description, @goal, class:"w-full block" %>
      </h3>

      <!--    Progress-->
      <div class="flex items-center justify-between gap-x-1 bg-gray-100 p-2 rounded dark:bg-dark-goalCardMilestones ">
        <div class="flex items-center">
          <%= image_tag 'progress.svg', class: "w-5 h-5" %>
          <span class="pl-2 text-xs font-normal text-light-text-main dark:text-white">
        <%= @milestone_reached %> Milestones Reached </span>
        </div>
        <%= image_tag 'eye_dark.svg', class: "w-5 h-5" %>
      </div>
      <div class="flex flex-col gap-y-2">
        <small class="text-xs font-normal text-[#717171] dark:text-white">
          You’ve met <span class={"font-bold"}><%= @percentage %>% </span> of your goal</small>
        <div class="w-full bg-indigo-200 rounded h-1 flex items-center">
          <div class="bg-light-bg-darkPurple rounded h-1 my-2 w-[<%= @percentage %>%]" style="width: <%= @percentage %>%"></div>
        </div>
      </div>
      <!--    end-->

      <!--    Milestones-->
      <div class="mt-3 text-xs  font-medium  text-light-text-main pb-1 dark:text-white">
        Next Milestone
      </div>
      <p class="hidden text-xs text-light-text-main">
        When you’ve completed your next milestone, you can check it as done to
        update your goal
      </p>
      <% if @message %>
        <div class="flex justify-center items-center gap-x-2 bg-light-bg-secondary rounded-xl p-3">
          <p class="text-xs font-medium text-light-text-main text-center">
            <%= @message %>
          </p>
        </div>
      <% else %>
        <div class="flex items-center gap-x-2 bg-light-bg-secondary rounded-xl p-3 dark:bg-dark-goalCardMilestones">
          <button class="w-5 h-5 rounded-3xl bg-gray-200 text-white flex justify-center items-center hover: cursor-pointer" data-action="click->milestones#markMilestone">
            &#10003
          </button>
          <p class="text-base font-medium text-light-text-main dark:text-white">
            Milestone <%= @milestone_number %>:
            <%= @goal.milestones.where(status: 'in_progress')&.first&.description %>
          </p>
        </div>
      <% end %>


      <p class="hidden text-light-text-secondary">
        <strong class="font-medium">Created At:</strong>
        <%= @goal.created_at.to_fs(:short) %>
      </p>

      <%# if action_name != "show" %> <%# end %>
      <%= button_to achieve_milestone_path(id: @goal.milestones.where(status: 'in_progress')&.first&.id || 0),
                    method: :post,
                    disabled: true,

                    class: "updateBtn w-full rounded-2xl bg-light-bg-darkPurple dark:bg-dark-updateProgress dark:text-dark-updateProgressText text-sm font-semibold p-2 text-white mt-2
      disabled:bg-light-bg-lightGray
      disabled:cursor-not-allowed
      disabled:opacity-60
      disabled:text-light-text-main" do %>
        Update Progress
      <% end %>
    </div>
  </div>
<% end %>
